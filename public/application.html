<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <title>GoEasy - To do list</title>
    <script type="text/javascript" src="todo.js"></script>
    <link rel="shortcut icon" type="image/png" href="/Pictures/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="todo.css">
    <script src="superfetch.js"></script>
</head>

<body>

    <div class="header-wrapper">
        
    <a href="https://go-easy.herokuapp.com/"><img id="avatar" title="Logout"></a>
          
    <h4 id="user"></h4>
    
    <a href="application.html"><img src="https://image.ibb.co/no1dQ6/bjelle.png" alt="bell" id="bell" width="30" height="40" align="right"></a>
    <a href="application.html"><img src="Pictures/logo_eksamen2.png" alt="logo" id="logo" width="130" height="30"></a>  
</div>


    <br><br><br>

    <div class="calendar-wrapper">

        <button id="btnPrev" type="button">Prev</button>
        <button id="btnNext" type="button">Next</button>

        <div id="divCal"></div>

    </div>

    <div class="calendar-wrapper2">


        <div id="center-container">

            <form name="form">
                <center>
                    <input type="text" placeholder="Add something to the list!" id="item" name="itemEntered" onkeypress="return searchKeyPress(event);" />
                    <input type="button" value="Add task" id="addTaskButton" onclick="javascript:createTask(document.form.itemEntered.value, selectedDay); ClearFields();" />
                    <input type="button" value="Remove task" id="removeTaskButton" onclick="javascript:removeItem();" />
                </center>
            </form>

        </div>



        <h2>Things to do:</h2>

        <div id="items-container">
            <ul id="items-listed">
            </ul>

        </div>

    </div>



</body>

<script>
    var loginData = JSON.parse(localStorage.getItem("logindata"));
        var pathBase="https://go-easy.herokuapp.com";
//    var pathBase="http://localhost:8080";
    if (loginData == null) {
        window.location.href = "https://go-easy.herokuapp.com/notfound.html";
        //        window.location.href = "http://localhost:8080/notfound.html";
    }

    //    var inpYear = document.getElementById("inpYear");
    //    var inpMonth = document.getElementById("inpMonth");
    //    var btn = document.getElementById("btn");
    var mHeader = document.getElementById("user");
    var outText = document.getElementById("outText");
    var imgAvatar = document.getElementById("avatar");
    var tasklist = JSON.parse(localStorage.getItem("tasklist"));
    console.log(tasklist);
    var token = loginData.token;
    var mUsername = loginData.username;
    var mDataURI = loginData.avatar;

    mHeader.innerHTML = `Logged in as: ${mUsername}`;
    imgAvatar.setAttribute(
        'src', mDataURI
    );

    /*btn.onclick = function() {

        outText.innerHTML = "";

        var d = new Date(inpYear.value, inpMonth.value);
        var month = d.getMonth();
        var i = 1;
        var m = month;
        var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        d.setDate(i);

        while (m == month) {
            let dateId = d.toDateString().replace(/ /g, '');
            var html = `<div class="wrapper">
                            <div class="day" ${d.getDay() == 0 ? 'style="color: #FF0000"' : ''}>
                                <h1>${i}</h1>                        
                                <h3>${days[d.getDay()]}</h3>
                            </div>
                            <div class="taskDesc">
                                <textarea id="${dateId}" type="text" rows="2" cols="100" onkeyup="save(this)">${dateId in taskList ? taskList[dateId] : ''}</textarea>
                            </div>
                            <div class="clr"></div>
                        </div>
                        <hr>`;

            outText.innerHTML += html;

            i++;
            d.setDate(i);
            m = d.getMonth(); //are we passed current month?           
        }
    }*/

    /*function save(context) {
        var dayKey = context.id;
        taskList[dayKey] = context.value;
        localStorage.setItem("taskList", JSON.stringify(taskList));

    }
*/

    function createTask(title, date) {

        let data = JSON.stringify({
            title: title,
            date: date,
            description: "desc",
            user: loginData.username
        });

//                var url = "https://go-easy.herokuapp.com/tasks/save?token=" + token;
        var url = pathBase + "/tasks/save?token=" + token;

        var cfg = {
            method: "POST",
            body: data,
            headers: {
                "content-type": "application/json"
            }

        }
        superfetch(url, "json", succ, error, cfg);
    }

    function deleteTask(task_id) {
//        var url = "https://go-easy.herokuapp.com/tasks/delete/" + task_id + "?token=" + token;
        var url = pathBase + "/tasks/delete/" + task_id + "?token=" + token;

        var cfg = {
            method: "DELETE"
        }
        superfetch(url, "json", delsucc, error, cfg);
    }


    function succ(data) {
        addItem(data.data);
        console.log(data);
        //        inputs.style.display = 'none';        
        //        txtMsg.innerHTML = data.msg;
    }

    function delsucc(data) {
        let taskID=data.id;
        for (i = 0; i < tasklist.length; i++) {
            if (tasklist[i].id == taskID) {
                console.log("match:" + i+" and " +taskID);
                tasklist.splice(i, 1);
            }

        }
        localStorage.setItem("tasklist", JSON.stringify(tasklist));
        //        inputs.style.display = 'none';        
        //        txtMsg.innerHTML = data.msg;
    }

    // ------------------------------------------------
    function error(error) {

        console.log(error);
        //txtMsg.innerHTML = "Something went wrong. Please try again.";
    }

</script>




</html>
